---
title: Authenticate users with a custom backend
description: Inject headers and metadata with a custom fetch function.
---

import { TabItem, Tabs } from '@astrojs/starlight/components';

:::note[Note]
This guide is for a **custom backend** using the ChatKit Python SDK.
For the hosted backend, see [Authenticate users with a hosted backend](/chatkit-js/guides/authenticate-hosted).
:::

To protect the ChatKit endpoints exposed by your server using the ChatKit Python SDK, use a custom fetch function to inject your own auth headers and metadata on every request.


## Inject headers with `api.fetch`

- Point ChatKit at your endpoint with `api.url`.
- Add auth headers through the `fetch` override.

<Tabs syncKey="language">
<TabItem label="React">
  ```jsx
    const auth = getUserAuth(); // your custom auth info

    const { control } = useChatKit({
      api: {
        url: 'https://your-domain.com/your/chatkit/api',

        // Any info you inject in the custom fetch callback is invisible to ChatKit.
        fetch(url: string, options: RequestInit) {
          return fetch(url, {
            ...options,

            // Inject your auth header here.
            headers: {
              ...options.headers,
              "Authorization": `Bearer ${auth}`,
            },
          });
        },

        // Register your domain in the dashboard at
        // https://platform.openai.com/settings/organization/security/domain-allowlist
        domainKey: "your-domain-key",
      },
    });
  ```

</TabItem>

<TabItem label="Vanilla JS">

  ```js
    const chatkit = document.getElementById('my-chat');

    chatkit.setOptions({
      api: {
        url: 'https://your-domain.com/your/chatkit/api',
        fetch(url: string, options: RequestInit) {
          return fetch(url, {
            ...options,
            headers: {
              ...options.headers,
              // Inject your auth header here.
              // Anything you do in this callback is invisible to ChatKit.
              "Authorization": `Bearer ${auth}`,
            },
          });
        },
        // Register your domain in the dashboard at
        // https://platform.openai.com/settings/organization/security/domain-allowlist
        domainKey: "your-domain-key",
      },
    });
  ```

</TabItem>
</Tabs>

## Backend responsibilities

- Validate every request (auth headers, cookies, or signed params) before invoking your agent.
- Scope data to the requesting user and session; the ChatKit Python SDK does not define the concept of a "user" or "session".
